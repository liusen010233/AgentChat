/**
 * ========== 布局样式文件 ==========
 * 功能：定义应用的主要布局结构，包括侧边栏、主内容区域和响应式设计
 * 布局模式：三栏布局（左侧边栏 + 主内容区 + 右侧边栏）
 * 关联文件：chat_ui.html(HTML结构), ui.js(交互控制), base.css(基础变量)
 * 设计特点：支持侧边栏折叠、响应式适配、流畅的过渡动画
 */

/* ========== 左侧边栏：群聊历史列表 ========== */
/* 功能：显示用户的群聊历史记录，支持搜索和管理 */
/* 交互：可折叠、可搜索、支持群聊切换和删除 */
/* 关联组件：chat.js(群聊数据), ui.js(折叠控制) */
.sidebar {
    width: 280px;                       /* 标准宽度，适合显示群聊信息 */
    background-color: var(--background-darker);  /* 深色背景，与主区域区分 */
    border-right: 1px solid var(--border-color); /* 右边框，视觉分割 */
    display: flex;                      /* Flexbox布局，垂直排列子元素 */
    flex-direction: column;             /* 垂直方向：头部 + 搜索 + 列表 */
    overflow: hidden;                   /* 隐藏溢出，确保布局整洁 */
    transition: width 0.3s ease;       /* 宽度变化动画，支持折叠效果 */
}

/* 左侧边栏折叠状态：最小化显示，仅保留核心功能 */
.sidebar.collapsed {
    width: 60px;                        /* 折叠后宽度，仅显示图标 */
}

/* ========== 侧边栏折叠状态样式优化 ========== */
/* 目的：在折叠状态下隐藏文本内容，仅保留必要的交互元素 */
/* 隐藏的元素：标题、群聊列表、除切换按钮外的其他按钮 */
.sidebar.collapsed .sidebar-title,
.sidebar.collapsed .chat-list,
.sidebar.collapsed .sidebar-btn:not(.sidebar-toggle) {
    display: none;                      /* 完全隐藏，节省空间 */
}

/* 折叠状态下的头部布局调整 */
.sidebar.collapsed .sidebar-header {
    justify-content: center;            /* 居中对齐 */
    padding: 15px 5px;                  /* 减少水平内边距 */
    flex-direction: column;             /* 垂直排列 */
    gap: 10px;                          /* 元素间距 */
}

/* 确保切换按钮在折叠时仍然可见和可用 */
.sidebar.collapsed .sidebar-toggle {
    display: flex !important;           /* 强制显示，覆盖隐藏规则 */
    position: relative;                 /* 相对定位 */
    top: 0;                             /* 重置位置 */
}

/* 折叠状态的视觉增强：添加展开提示区域 */
/* 功能：在侧边栏右侧添加可点击的展开区域，提升用户体验 */
.sidebar.collapsed::after {
    content: '';                        /* 伪元素，无文本内容 */
    position: absolute;                 /* 绝对定位，不影响布局 */
    right: -12px;                       /* 位于侧边栏右侧外部 */
    top: 50%;                           /* 垂直居中 */
    transform: translateY(-50%);        /* 精确居中对齐 */
    width: 24px;                        /* 展开区域宽度 */
    height: 60px;                       /* 展开区域高度 */
    background: var(--background-darker);  /* 与侧边栏背景一致 */
    border: 1px solid var(--border-color); /* 边框样式 */
    border-left: none;                  /* 移除左边框，与侧边栏连接 */
    border-radius: 0 8px 8px 0;         /* 右侧圆角 */
    cursor: pointer;                    /* 鼠标悬停显示手型 */
    z-index: 10;                        /* 确保在上层显示 */
}

/* 右侧边栏折叠样式优化 */
.members-sidebar.collapsed {
    width: 60px;
}

.members-sidebar.collapsed .members-header span,
.members-sidebar.collapsed .members-list {
    display: none;
}

.members-sidebar.collapsed .members-header {
    justify-content: center;
    padding: 15px 5px;
}

/* 确保右侧边栏的切换按钮在折叠时可见 */
.members-sidebar.collapsed .sidebar-toggle {
    display: flex !important;
}

/* 为折叠状态的右侧边栏添加展开按钮 */
.members-sidebar.collapsed::before {
    content: '';
    position: absolute;
    left: -12px;
    top: 50%;
    transform: translateY(-50%);
    width: 24px;
    height: 60px;
    background: var(--background-darker);
    border: 1px solid var(--border-color);
    border-right: none;
    border-radius: 8px 0 0 8px;
    cursor: pointer;
    z-index: 10;
}

/* ========== 侧边栏头部区域 ========== */
/* 功能：显示应用标题和主要操作按钮（新建群聊、折叠等） */
/* 布局：标题在左，操作按钮在右，支持响应式调整 */
.sidebar-header {
    padding: 15px;                      /* 内边距，提供舒适的视觉空间 */
    border-bottom: 1px solid var(--border-color); /* 底部边框，与下方内容分割 */
    display: flex;                      /* Flexbox布局，水平排列 */
    justify-content: space-between;     /* 两端对齐：标题左，按钮右 */
    align-items: center;                /* 垂直居中对齐 */
}

/* 侧边栏折叠切换按钮：特殊功能按钮，独立样式 */
.sidebar-toggle {
    background: none;                   /* 透明背景 */
    border: none;                       /* 无边框 */
    color: var(--accent-color);         /* 强调色，突出重要功能 */
    cursor: pointer;                    /* 可点击指示 */
    font-size: 14px;                    /* 图标字体大小 */
    padding: 5px;                       /* 紧凑内边距 */
    display: flex;                      /* Flexbox布局 */
    align-items: center;                /* 垂直居中 */
    justify-content: center;            /* 水平居中 */
}

/* 侧边栏标题样式 */
.sidebar-title {
    font-size: 16px;                    /* 标题字体大小 */
    font-weight: 600;                   /* 半粗体，突出重要性 */
    color: var(--light-text);           /* 亮色文本，提高可读性 */
}

/* 侧边栏操作按钮容器：新建群聊等功能按钮的容器 */
.sidebar-actions {
    display: flex;                      /* 水平排列按钮 */
    gap: 10px;                          /* 按钮间距 */
}

/* ========== 侧边栏操作按钮 ========== */
/* 功能：提供新建群聊、设置等操作 */
/* 交互：悬停效果、点击反馈，关联ui.js中的事件处理 */
.sidebar-btn {
    background: none;                   /* 透明背景，简洁设计 */
    border: none;                       /* 无边框，现代扁平风格 */
    color: var(--accent-color);         /* 强调色，与主题保持一致 */
    cursor: pointer;                    /* 鼠标悬停显示手型 */
    font-size: 14px;                    /* 图标字体大小 */
    padding: 5px;                       /* 内边距，增加点击区域 */
    display: flex;                      /* Flexbox布局，居中图标 */
    align-items: center;                /* 垂直居中 */
    justify-content: center;            /* 水平居中 */
}

/* 按钮悬停状态：提供视觉反馈 */
.sidebar-btn:hover {
    color: var(--light-text);           /* 悬停时文本变为亮色 */
}

/* ========== 搜索区域容器 ========== */
/* 功能：包含搜索输入框的容器区域 */
/* 布局：位于侧边栏头部下方，与群聊列表分离 */
.sidebar-search {
    padding: 10px 15px;                 /* 内边距，与侧边栏整体风格保持一致 */
    border-bottom: 1px solid var(--border-color); /* 底部边框，与群聊列表视觉分割 */
}

/* ========== 搜索输入框 ========== */
/* 功能：提供群聊搜索功能，支持实时过滤 */
/* 交互：焦点状态变化、占位符提示，关联chat.js中的搜索逻辑 */
.search-input {
    width: 100%;                        /* 占满容器宽度 */
    padding: 8px 12px;                  /* 内边距，提供舒适的输入空间 */
    background-color: var(--background-lighter); /* 浅色背景，与侧边栏区分 */
    border: 1px solid var(--border-color);       /* 边框，定义输入框边界 */
    border-radius: 4px;                 /* 小圆角，与整体设计风格一致 */
    color: var(--text-color);           /* 输入文本颜色 */
    font-size: 14px;                    /* 字体大小，保持可读性 */
}

/* 搜索框占位符样式 */
.search-input::placeholder {
    color: var(--accent-color);         /* 占位符文本颜色，使用强调色 */
}

/* ========== 群聊列表容器 ========== */
/* 功能：显示用户的群聊历史记录，支持滚动浏览 */
/* 数据来源：chat.js中的群聊数据管理 */
.chat-list {
    flex: 1;                            /* 占用剩余空间，自适应高度 */
    overflow-y: auto;                   /* 垂直滚动，处理长列表 */
    padding: 10px 0;                    /* 垂直内边距，顶部和底部留白 */
}

/* ========== 群聊项样式 ========== */
/* 功能：单个群聊的显示卡片，包含头像、信息和操作 */
/* 交互：悬停效果、激活状态、点击切换，关联chat.js中的群聊切换逻辑 */
.chat-item {
    padding: 10px 15px;                 /* 内边距，提供点击区域 */
    display: flex;                      /* Flexbox布局，水平排列元素 */
    align-items: center;                /* 垂直居中对齐 */
    cursor: pointer;                    /* 鼠标悬停显示手型 */
    transition: background-color 0.2s ease; /* 背景色过渡动画 */
}

/* 群聊项悬停状态：提供交互反馈 */
.chat-item:hover {
    background-color: var(--hover-color); /* 悬停背景色 */
}

/* 群聊项激活状态：当前选中的群聊 */
.chat-item.active {
    background-color: var(--hover-color);     /* 激活背景色 */
    border-left: 3px solid var(--primary-color); /* 左侧边框，突出当前选择 */
}

/* ========== 群聊头像样式 ========== */
/* 功能：显示群聊的视觉标识，使用背景色和首字母 */
/* 设计：圆形头像，统一背景色，白色文字，标准尺寸 */
.chat-avatar {
    width: 40px;                        /* 头像宽度，标准尺寸 */
    height: 40px;                       /* 头像高度，保持正方形 */
    border-radius: 50%;                 /* 圆形头像 */
    background-color: var(--secondary-color); /* 统一背景色，与主题保持一致 */
    display: flex;                      /* Flexbox布局，居中文字 */
    align-items: center;                /* 垂直居中 */
    justify-content: center;            /* 水平居中 */
    font-weight: bold;                  /* 粗体文字，突出显示 */
    color: var(--light-text);           /* 亮色文字，与背景对比 */
    margin-right: 10px;                 /* 右边距，与信息区域分离 */
    flex-shrink: 0;                     /* 不允许收缩，保持固定尺寸 */
}
/* 成员与聊天头像配色对齐 */
.member-avatar {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background-color: var(--secondary-color);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    color: var(--light-text);
    margin-right: 10px;
    flex-shrink: 0;
}
/* 智能体浅灰、用户蓝色（通过父元素类名区分）*/
.member-item.agent .member-avatar { background-color: #e0e0e0; color: #212121; }
.member-item.user .member-avatar { background-color: var(--primary-color); color: #ffffff; }
/* ========== 群聊信息区域 ========== */
/* 功能：显示群聊名称和最新消息预览 */
/* 布局：垂直排列，支持文本溢出处理 */
.chat-info {
    flex: 1;                            /* 占用剩余空间，自适应宽度 */
    min-width: 0;                       /* 允许收缩，配合文本溢出处理 */
}

/* 群聊名称样式 */
.chat-name {
    font-weight: 600;                   /* 半粗体，突出重要性 */
    color: var(--light-text);           /* 亮色文字，提高可读性 */
    margin-bottom: 3px;                 /* 底部间距，与预览文本分离 */
    white-space: nowrap;                /* 不换行 */
    overflow: hidden;                   /* 隐藏溢出内容 */
    text-overflow: ellipsis;            /* 溢出显示省略号 */
}

/* 消息预览样式 */
.chat-preview {
    font-size: 12px;                    /* 预览文本字体大小，较小 */
    color: var(--accent-color);         /* 强调色，不抢夺注意力 */
    white-space: nowrap;                /* 不换行 */
    overflow: hidden;                   /* 隐藏溢出内容 */
    text-overflow: ellipsis;            /* 溢出显示省略号 */
}

.chat-meta {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    margin-left: 10px;
}

.chat-time {
    font-size: 11px;
    color: var(--accent-color);
    margin-bottom: 3px;
}

.chat-badge {
    background-color: var(--primary-color);
    color: white;
    font-size: 11px;
    padding: 2px 6px;
    border-radius: 10px;
    min-width: 20px;
    text-align: center;
}

/* 右侧边栏 - 成员列表 */
.members-sidebar {
    width: 280px;
    background-color: var(--background-darker);
    border-left: 1px solid var(--border-color);
    display: flex;
    flex-direction: column;
    overflow: hidden;
    transition: all 0.3s ease;
}

.members-sidebar.collapsed {
    width: 60px;
}

.members-header {
    padding: 15px;
    border-bottom: 1px solid var(--border-color);
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 16px;
    font-weight: 600;
    color: var(--light-text);
}

/* ========== 成员列表容器 ========== */
/* 功能：显示当前群聊的所有成员，支持滚动浏览 */
/* 数据来源：member.js中的成员数据管理 */
.members-list {
    flex: 1;                            /* 占用剩余空间，自适应高度 */
    overflow-y: auto;                   /* 垂直滚动，处理长列表 */
    padding: 10px 0;                    /* 垂直内边距，顶部和底部留白 */
}

/* ========== 成员项样式 ========== */
/* 功能：单个成员的显示卡片，包含头像、信息和操作 */
/* 交互：悬停效果、删除操作，关联member.js中的成员管理逻辑 */
.member-item {
    padding: 10px 15px;                 /* 内边距，提供点击区域 */
    display: flex;                      /* Flexbox布局，水平排列元素 */
    align-items: center;                /* 垂直居中对齐 */
    transition: background-color 0.2s ease, opacity 0.5s ease, transform 0.5s ease; /* 多重过渡动画 */
}

/* 成员项悬停状态：提供交互反馈 */
.member-item:hover {
    background-color: var(--hover-color); /* 悬停背景色 */
}

/* 成员删除过渡动画：平滑移除效果 */
.member-item.deleting {
    opacity: 0;                         /* 淡出效果 */
    transform: translateX(30px);        /* 向右滑出 */
}

/* ========== 成员信息区域 ========== */
/* 功能：显示成员名称和角色信息 */
/* 布局：垂直排列，支持文本溢出处理 */
.member-info {
    flex: 1;                            /* 占用剩余空间，自适应宽度 */
    min-width: 0;                       /* 允许收缩，配合文本溢出处理 */
}

/* 成员名称样式 */
.member-name {
    font-weight: 600;                   /* 半粗体，突出重要性 */
    color: var(--light-text);           /* 亮色文字，提高可读性 */
    margin-bottom: 3px;                 /* 底部间距，与角色信息分离 */
    white-space: nowrap;                /* 不换行 */
    overflow: hidden;                   /* 隐藏溢出内容 */
    text-overflow: ellipsis;            /* 溢出显示省略号 */
}

/* 成员角色标识 */
.member-role {
    font-size: 12px;                    /* 角色文本字体大小，较小 */
    color: var(--accent-color);         /* 强调色，不抢夺注意力 */
}

.member-status {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    margin: 0 10px;
}

.status-online {
    background-color: var(--online-color);
}

.status-offline {
    background-color: var(--offline-color);
}

.delete-member-btn {
    background: none;
    border: none;
    color: var(--accent-color);
    cursor: pointer;
    font-size: 12px;
    padding: 5px;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 1;
    transition: opacity 0.2s ease;
    position: relative;
    z-index: 10;
}

.member-item:hover .delete-member-btn {
    color: #ff4444;
}

/* ========== 主聊天区域 ========== */
/* 功能：显示聊天消息、输入框等核心聊天功能 */
/* 布局：垂直排列，头部+消息区+输入区，关联chat.js和ui.js */
/* 交互：支持侧边栏折叠状态的边距调整，提供流畅的布局过渡 */
.main-content {
    flex: 1;                            /* 占用剩余空间，自适应宽度 */
    display: flex;                      /* Flexbox布局，垂直排列子元素 */
    flex-direction: column;             /* 垂直方向：头部 + 消息 + 输入 */
    overflow: hidden;                   /* 隐藏溢出，确保布局整洁 */
    transition: margin 0.3s ease;       /* 边距过渡动画，配合侧边栏折叠 */
    position: relative;                 /* 相对定位，为子元素提供定位上下文 */
}

/* 左侧边栏折叠状态：调整主内容区域左边距 */
.main-content.sidebar-collapsed {
    margin-left: 60px;                  /* 为折叠后的侧边栏预留空间 */
}

/* 右侧边栏折叠状态：调整主内容区域右边距 */
.main-content.members-collapsed {
    margin-right: 60px;                 /* 为折叠后的成员栏预留空间 */
}

/* ========== 响应式布局设计 ========== */
/* 目的：在移动设备上提供良好的用户体验 */
/* 策略：侧边栏变为覆盖层，主聊天区域占满屏幕 */
/* 断点：768px，适配平板和手机设备 */
@media (max-width: 768px) {
    /* 左侧边栏移动端适配：绝对定位，默认隐藏在左侧 */
    .sidebar {
        position: absolute;             /* 绝对定位，脱离正常文档流 */
        left: 0;                        /* 左侧对齐 */
        top: 0;                         /* 顶部对齐 */
        bottom: 0;                      /* 底部对齐，占满高度 */
        z-index: 100;                   /* 高层级，覆盖主内容 */
        transform: translateX(-100%);   /* 默认向左平移隐藏 */
    }
    
    /* 左侧边栏激活状态：滑入屏幕显示 */
    .sidebar.active {
        transform: translateX(0);       /* 恢复原位置，显示侧边栏 */
    }
    
    /* 右侧成员栏移动端适配：绝对定位，默认隐藏在右侧 */
    .members-sidebar {
        position: absolute;             /* 绝对定位，脱离正常文档流 */
        right: 0;                       /* 右侧对齐 */
        top: 0;                         /* 顶部对齐 */
        bottom: 0;                      /* 底部对齐，占满高度 */
        z-index: 100;                   /* 高层级，覆盖主内容 */
        transform: translateX(100%);    /* 默认向右平移隐藏 */
    }
    
    /* 右侧成员栏激活状态：滑入屏幕显示 */
    .members-sidebar.active {
        transform: translateX(0);       /* 恢复原位置，显示成员栏 */
    }
    
    /* 主内容区域移动端适配：重置边距，占满可用空间 */
    .main-content {
        margin-left: 0 !important;      /* 强制重置左边距，避免折叠状态影响 */
        margin-right: 0 !important;     /* 强制重置右边距，避免折叠状态影响 */
    }
}

/* ========== 聊天头部区域 ========== */
/* 功能：显示当前群聊信息和操作按钮 */
/* 布局：左侧群聊信息，右侧操作按钮，关联chat.js和ui.js */
.chat-header {
    padding: 15px;                      /* 内边距，提供舒适的视觉空间 */
    border-bottom: 1px solid var(--border-color); /* 底部边框，与消息区域分割 */
    display: flex;                      /* Flexbox布局，水平排列 */
    justify-content: space-between;     /* 两端对齐：信息左，操作右 */
    align-items: center;                /* 垂直居中对齐 */
}

/* 聊天标题容器 */
.chat-title {
    display: flex;                      /* Flexbox布局，水平排列标题元素 */
    align-items: center;                /* 垂直居中对齐 */
}

/* 群聊名称显示 */
.chat-name-display {
    font-size: 18px;                    /* 标题字体大小 */
    font-weight: 600;                   /* 半粗体，突出重要性 */
    color: var(--light-text);           /* 亮色文本，提高可读性 */
    margin-right: 10px;                 /* 右边距，与描述分离 */
}

/* 群聊描述文本 */
.chat-desc {
    font-size: 14px;                    /* 描述字体大小，比标题小 */
    color: var(--accent-color);         /* 强调色，不抢夺注意力 */
}

/* 聊天操作按钮组 */
.chat-actions {
    display: flex;                      /* 水平排列按钮 */
    gap: 15px;                          /* 按钮间距 */
}

/* ========== 聊天操作按钮 ========== */
/* 功能：提供群聊管理操作（成员管理、设置等） */
/* 交互：悬停效果、点击反馈，关联ui.js中的事件处理 */
.chat-action-btn {
    background: none;                   /* 透明背景，简洁设计 */
    border: none;                       /* 无边框，现代扁平风格 */
    color: var(--accent-color);         /* 强调色，与主题保持一致 */
    cursor: pointer;                    /* 鼠标悬停显示手型 */
    font-size: 16px;                    /* 图标字体大小 */
    padding: 5px;                       /* 内边距，增加点击区域 */
    display: flex;                      /* Flexbox布局，居中图标 */
    align-items: center;                /* 垂直居中 */
    justify-content: center;            /* 水平居中 */
}

/* 操作按钮悬停状态：提供视觉反馈 */
.chat-action-btn:hover {
    color: var(--light-text);           /* 悬停时文本变为亮色 */
}

/* Chat header primary buttons (align with .chat-action-btn) */
.chat-btn {
  background: var(--background-lighter);
  border: 1px solid var(--border-color);
  color: var(--text-color);
  cursor: pointer;
  font-size: 14px;
  padding: 8px 12px;
  border-radius: 10px;
  display: inline-flex;
  align-items: center;
  gap: 8px;
  transition: background .2s ease, color .2s ease, border-color .2s ease, box-shadow .2s ease;
}

.chat-btn i { font-size: 14px; }

.chat-btn:hover {
  background: var(--hover-color);
  color: var(--light-text);
  border-color: var(--hover-color);
  box-shadow: 0 4px 12px rgba(0,0,0,.25);
}

/* 历史记录侧边栏卡片三行布局（名称/描述/建群时间） */
.chat-item { display: flex; flex-direction: column; position: relative; }
.chat-item .chat-name { font-size: 15px; font-weight: 600; color: var(--light-text); margin-bottom: 4px; }
.chat-item .chat-desc { font-size: 13px; color: var(--accent-color); margin-bottom: 4px; }
.chat-item .chat-created { font-size: 13px; color: var(--accent-color); }
/* 让聊天项成为定位上下文，便于右上角删除按钮绝对定位 */
.chat-item { position: relative; }

/* ========== 群聊删除按钮 ========== */
/* 功能：删除群聊记录，仅在悬停时显示 */
/* 交互：悬停显示、点击确认，关联chat.js中的删除逻辑 */
.delete-chat-btn {
  background: none;                   /* 透明背景，简洁设计 */
  border: none;                       /* 无边框 */
  color: var(--accent-color);         /* 强调色，与主题保持一致 */
  cursor: pointer;                    /* 鼠标悬停显示手型 */
  font-size: 14px;                    /* 图标字体大小 */
  padding: 5px;                       /* 内边距，增加点击区域 */
  position: absolute;                 /* 绝对定位，固定在右上角 */
  right: 10px;                        /* 距离右边距 */
  top: 10px;                          /* 距离顶部距离 */
  display: flex;                      /* Flexbox布局，居中图标 */
  align-items: center;                /* 垂直居中 */
  justify-content: center;            /* 水平居中 */
  transition: color 0.2s;             /* 颜色过渡动画 */
  z-index: 2;                         /* 确保在上层显示 */
}

/* 删除按钮悬停状态：危险操作的视觉警告 */
.delete-chat-btn:hover { 
  color: var(--offline-color);        /* 悬停时变为警告色 */
}

/* ========== 删除过渡动画 ========== */
/* 功能：为删除操作提供平滑的视觉反馈 */
/* 效果：淡出并轻微上移，提升用户体验 */
.chat-item.deleting {
  animation: fade-out 0.5s forwards;  /* 执行淡出动画 */
  opacity: 0.5;                       /* 删除过程中的半透明状态 */
}

/* 淡出动画关键帧定义 */
@keyframes fade-out {
  from { 
    opacity: 1;                       /* 起始状态：完全不透明 */
    transform: translateY(0);         /* 起始位置：原位置 */
  }
  to { 
    opacity: 0;                       /* 结束状态：完全透明 */
    transform: translateY(-2px);      /* 结束位置：轻微上移 */
  }
}