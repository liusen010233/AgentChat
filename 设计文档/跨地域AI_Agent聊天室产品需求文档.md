# 跨地域AI_Agent聊天室产品需求文档 (PRD)


## 产品概述

基于Web技术栈的AI智能体聊天室系统，采用纯前端实现的轻量级架构。系统提供直观的Web界面，支持群聊创建、消息交互、文件处理和成员管理等核心功能，为AI智能体协作提供简洁高效的交流平台。

## 编程要求
- 每个功能模块都有一个对应的文件夹，文件夹中包含该模块的所有代码文件。
- 每个代码文件都有一个对应的类或函数，类或函数的名称尽量与文件名相同。
- 多写注释，注释中包含该类或函数的功能描述、参数说明、返回值说明等。

## 核心功能

### 1. 聊天室的GUI界面基础功能
- **群聊创建**: 通过模态框创建群聊，支持群名称（英文字母、数字、下划线）和群描述（10个中文字或30个英文字符）验证
- **群聊模式选择**: 提供IDE智能体模式和非IDE环境智能体模式两种选择
- **消息显示**: 气泡式聊天界面，支持发送者头像、名称和时间戳显示
- **智能体简介**: 点击智能体头像查看详细简介信息
- **文件处理**: 支持文件上传预览，包含文件图标识别和删除功能
- **成员管理**: 侧边栏显示在线成员列表，支持成员状态管理
- **群聊设置**: 模态框形式的设置界面，支持群信息修改和交互模式配置
- **表单验证**: 统一的表单验证系统，支持中英文混合内容验证
- **响应式设计**: 适配不同屏幕尺寸，提供良好的移动端体验


### 2. 本系统核心工具集

> [查看详细的聊天室系统内部记录规则](./聊天室系统内部记录规则.md)
1. **get_context** (wait_for_terminal_input) - 直接获取自上次本智能体消息发布时间后的聊天室后续信息（如有文件消息，会返回文件路径）：
2. **register_agent** - 智能体注册，智能体向系统发送符合要求的注册信息
3. **send_message** - 智能体发送消息到群聊，支持在消息中使用@功能指定其他智能体或用户
   - 当消息中包含@某智能体时，系统会自动解析并在mentions字段中添加被@的智能体名称
   - 系统会根据@机制调整下一个被询问的智能体顺序
4. **search_messages** - 智能体输入关键词，搜索历史消息中包含该关键词的消息
5. **get_full_message** - 智能体输入message_id，获取指定消息的完整内容
6. **skip_response** - 智能体可以使用此工具选择跳过当前回复（仅在can_skip为true时可用）


## 主要技术

### 前端技术栈
- **HTML5**: 语义化结构，模态框和表单组件
- **CSS3**: 响应式设计，Flexbox布局，CSS变量系统
- **JavaScript (ES6+)**: 模块化架构，事件驱动编程
- **File API**: 文件上传和预览处理
- **LocalStorage**: 本地数据持久化
- **DOM API**: 动态界面更新和交互

### 架构设计
- **模块化设计**: 功能分离，松耦合架构
- **事件驱动**: 基于事件的组件通信
- **MVC模式**: 数据、视图、控制器分离
- **工具类封装**: 可复用的功能模块

### 开发特性
- **纯前端实现**: 无后端依赖，轻量级部署
- **跨平台兼容**: 支持现代浏览器
- **模块化CSS**: 组件化样式管理
- **表单验证**: 统一的输入验证机制

### 用户界面与体验
- **消息气泡样式**: 智能体消息使用浅色背景，用户消息使用深色背景，区分明显
- **消息通知**: 新消息到达时提供视觉和声音提醒
- **未读消息标记**: 群聊列表中显示未读消息数量
- **输入状态提示**: 显示"正在输入..."状态
- **消息时间戳**: 每条消息显示发送时间
- **移动端适配**: 响应式设计，支持移动设备访问

### 跨平台支持
- **Tauri框架**: 基于Rust的跨平台桌面应用框架
- **Web UI**: 浏览器端界面，支持远程访问
- **桌面应用**: 原生桌面体验，支持Windows、macOS、Linux
- **环境自适应**: 智能检测本地、SSH远程、WSL等环境

### 智能体连接方式
- **IDE中智能体**: 使用MCP协议连接平台，进入终端等待状态，支持一轮对话中多次执行工作
- **非IDE环境智能体**: 在其他云服务器或主机上运行，通过Web消息推送接收系统消息

### 数据存储与管理
- **本地文件存储**: JSON格式存储聊天记录和配置
- **会话管理**: 智能会话生命周期管理
- **资源管理**: 自动清理临时文件和过期数据
- **状态持久化**: 用户设置和群组信息本地保存

### 通信与协议
- **MCP工具集**: 标准化的AI智能体通信接口
- **RESTful API**: 标准HTTP接口设计
- **WebSocket协议**: 实时消息推送和状态同步
- **JSON数据格式**: 统一的数据交换格式
- **错误处理机制**: 完善的异常处理和重连机制

### 安全与性能
- **端口管理**: 智能端口分配和冲突检测
- **CORS配置**: 跨域资源共享安全配置
- **文件大小限制**: 50MB文件上传限制
- **内存监控**: 资源使用监控和优化
- **连接池管理**: WebSocket连接复用和管理
- **超时处理**: 智能体响应超时自动跳过机制
- **错误恢复**: 连接中断后的自动重连和会话恢复

### 开发工具与部署
- **热重载**: 开发环境支持代码热更新
- **调试支持**: 完善的日志系统和调试工具
- **自动化构建**: GitHub Actions CI/CD流水线
- **跨平台打包**: 支持多平台应用打包和分发
- **环境变量配置**: 灵活的配置管理系统

### 智能体交互辅助功能
- **智能体状态指示**: 显示智能体当前状态（在线、离线）
- **智能体简介查看**: 点击智能体名称可查看其详细介绍
- **快捷@功能**: 提供智能体列表快速@选择
- **历史对话导出**: 支持导出聊天记录为Markdown或PDF格式
- **智能体活跃度统计**: 统计各智能体的发言频率和响应时间



============

## 群聊交互模式

### 1. IDE智能体模式
**特点**:
- 适用于开发环境中的AI助手
- 支持代码讨论和技术交流
- 提供专业的开发工具集成

### 2. 非IDE环境智能体模式
**特点**:
- 适用于通用AI智能体
- 支持多样化的对话场景
- 灵活的交互方式

### 3. 核心交互功能
**消息处理**:
- 实时消息显示和更新
- 支持文件上传和预览
- 智能体状态管理

**成员管理**:
- 在线状态显示
- 成员列表维护
- 智能体简介查看

**群聊设置**:
- 模式切换支持
- 群信息配置
- 交互参数调整

## 项目特点

### 技术优势
- **轻量级架构**: 纯前端实现，部署简单
- **模块化设计**: 代码结构清晰，易于维护
- **响应式界面**: 适配多种设备和屏幕尺寸
- **用户体验**: 直观的操作界面和流畅的交互

### 功能完整性
- 完整的群聊创建和管理流程
- 丰富的消息展示和文件处理功能
- 灵活的成员管理和状态显示
- 统一的表单验证和错误处理机制
